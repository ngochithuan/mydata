(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[58103],{158103:(e,t,a)=>{a.r(t),a.d(t,{VideoWrapper:()=>k,default:()=>T,getPlaylistSourceSrc:()=>f});var i=a(667294),s=a(883119),o=a(366284),r=a(780280),n=a(858416),l=a(562559),c=a(965900),d=a(407043),h=a(773285),u=a(19121),p=a(969315),y=a(179888),m=a(785893);function b(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function P(e,t){if(!e||void 0===e)return"undefined";if("string"==typeof e){let a=e;if(t){const i="control"===t?"v3.pinimg.com":"v2.pinimg.com";a=e.replace("v1.pinimg.com",i)}return a}if(Array.isArray(e)&&e[0].src){let a=e[0].src;if(t){const e="control"===t?"v3.pinimg.com":"v2.pinimg.com";a=a.replace("v1.pinimg.com",e)}return a}return"unsupported_type_"+typeof e}class S extends i.Component{constructor(...e){super(...e),b(this,"state",{canPlayVideo:!1,playbackState:y.Cy.DEFAULT,videoStartTime:this.props.seekTime?this.props.seekTime:this.props.videoStartTime||0}),b(this,"errorRetryCount",2),b(this,"hasSegmentStarted",!1),b(this,"hasPlaybackStarted",!1),b(this,"hasVideoSessionStarted",!1),b(this,"hasVideoSessionEnded",!1),b(this,"lastStallTime",null),b(this,"lastPauseTime",null),b(this,"logSessionStartOnNextPlay",!1),b(this,"playerId",""),b(this,"videoSessionId",""),b(this,"videoVisibleTime",null),b(this,"playbackPerformance",{canPlayTime:null,detailedErrors:"",errorCode:0,errorName:"",errorReason:"",hasFatalError:!1,loadStartTime:null,numberOfStalls:0,numberOfSeeks:0,playbackStartTimestamp:null,segments:[],srcString:P(this.props.src,this.props.quicExpGroup),totalStallDurationMs:0,totalPauseDurationMs:0}),b(this,"componentDidMount",(()=>{const{contextLogData:e={},playing:t}=this.props,{is_closeup_video:a=!1}=e;(0,p.tE)("videoMounted",!1,a),t&&(this.videoVisibleTime=new Date,this.logPlaybackPerformance(y.DR,{initiator:"mount"}))})),b(this,"componentDidUpdate",(e=>{const{playing:t,visible:a,appInFocus:i,seekTime:s}=this.props;s&&s!==e.seekTime&&this.setState({videoStartTime:s}),e.appInFocus&&!i&&(this.logPlaybackPerformance(y.$f,{initiator:"update"}),this.logSessionStartOnNextPlay=!0),e.visible&&!1===a&&(this.logSessionStartOnNextPlay=!1,this.updatePauseDuration(),this.logPlaybackPerformance(y.$f,{initiator:"update"})),!1===e.visible&&!0===a&&(this.videoVisibleTime=this.videoVisibleTime||new Date,t?(this.setPlaybackStartTime(),this.setLastSegmentStartPlayTime(),this.setLastSegmentPlaybackStartDate(),this.logPlaybackPerformance(y.DR,{initiator:"update"})):this.logSessionStartOnNextPlay=!0),t&&i&&this.logSessionStartOnNextPlay&&(this.setPlaybackStartTime(),this.setLastSegmentStartPlayTime(),this.setLastSegmentPlaybackStartDate(),this.logPlaybackPerformance(y.DR,{initiator:"update"}),this.logSessionStartOnNextPlay=!1)})),b(this,"addSegment",(()=>{const{canPlayTime:e,loadStartTime:t,segments:a,srcString:i}=this.playbackPerformance;let s=-1;e&&t&&0===a.length&&(s=e>t?e-t:0);const o=this.videoPlayerRef&&this.videoPlayerRef.video,r={indicatedKbps:-1,duration:o&&o.duration*y.gJ||-1,lastStartPlayTime:null,level:-1,numServerAddressChange:-1,observedKbps:-1,playbackStartDate:null,serverAddress:"",sourceWidth:-1,sourceHeight:-1,startupTimeMs:s,switchBitrateKbps:-1,uri:i,viewportWidth:o&&o.clientWidth||-1,viewportHeight:o&&o.clientHeight||-1,watchedDurationMs:0};a.push(r)})),b(this,"getCurrentVideoTime",(()=>this.videoPlayerRef&&this.videoPlayerRef.video?this.videoPlayerRef.video.currentTime*y.gJ:0)),b(this,"getVideoResourceTiming",(()=>{var e,t;if(null!==(e=window)&&void 0!==e&&null!==(t=e.performance)&&void 0!==t&&t.getEntriesByName&&this.playbackPerformance.srcString){const e=window.performance.getEntriesByName(this.playbackPerformance.srcString);return e.length>0&&e[0]||null}return null})),b(this,"handleCanPlayVideo",(e=>{const{contextLogData:t={},onReady:a,playing:i}=this.props,{is_closeup_video:s=!1}=t,{canPlayVideo:o}=this.state;(0,p.tE)("handleCanPlayVideo",!1,s,{firstCanPlayEvent:!o,playing:i}),this.playbackPerformance.hasFatalError=!1,o||(this.playbackPerformance.canPlayTime=new Date),this.setState({canPlayVideo:!0}),a&&a(e)})),b(this,"handleEnded",(e=>{const{loop:t,onEnded:a}=this.props,{segments:i}=this.playbackPerformance,s=i&&i[i.length-1];t&&this.videoPlayerRef&&this.videoPlayerRef.video?(this.updateWatchDurationForCurrentSegment(),s&&(s.lastStartPlayTime=0),this.hasSegmentStarted=!1):t||this.logPlaybackPerformance(y.$f,{initiator:"videoEnded",loop:t}),this.setState({playbackState:y.Cy.ENDED}),a&&a(e)})),b(this,"handleError",(()=>{var e,t,a,i,s,o,r,n;const{contextLogData:l={}}=this.props,{is_closeup_video:c=!1}=l,d=this.videoPlayerRef&&this.videoPlayerRef.video;(null==d||null===(e=d.error)||void 0===e?void 0:e.code)!==y.lG.MEDIA_ERR_ABORTED&&(this.playbackPerformance.hasFatalError=!0),this.playbackPerformance.detailedErrors+=`${this.playbackPerformance.detailedErrors.length>0?", ":""}${(null==d||null===(t=d.error)||void 0===t?void 0:t.message)||""}`,this.playbackPerformance.errorCode=(null==d||null===(a=d.error)||void 0===a?void 0:a.code)||0,this.playbackPerformance.errorName=(null==d||null===(i=d.error)||void 0===i||null===(s=i.message)||void 0===s?void 0:s.slice(0,100))||"unknown",this.playbackPerformance.errorReason=(null==d||null===(o=d.error)||void 0===o||null===(r=o.message)||void 0===r?void 0:r.slice(0,100))||"unknown";const h={errorName:this.playbackPerformance.errorCode,errorReason:this.playbackPerformance.errorName,errorRetryCount:this.errorRetryCount,playbackState:this.state.playbackState,networkState:(null==d?void 0:d.networkState)||"unknown"};switch((0,p.tE)("fatalError",!1,c,h),null==d||null===(n=d.error)||void 0===n?void 0:n.code){case y.lG.MEDIA_ERR_ABORTED:break;case y.lG.MEDIA_ERR_NETWORK:case y.lG.MEDIA_ERR_DECODE:case y.lG.MEDIA_ERR_SRC_NOT_SUPPORTED:default:this.errorRetryCount>0&&(null==d||d.load(),this.errorRetryCount-=1)}this.updateWatchDurationForCurrentSegment(),this.setState({playbackState:y.Cy.FAILED})})),b(this,"handleLoadedMetadata",(()=>{this.setState({playbackState:y.Cy.LOADED_METADATA})})),b(this,"handleLoadStart",(()=>{this.playbackPerformance.loadStartTime=new Date,this.setState({playbackState:y.Cy.LOAD_START})})),b(this,"handleLoadedData",(()=>{this.setState({playbackState:y.Cy.LOADED_DATA})})),b(this,"handlePlaying",(()=>{this.playbackPerformance.hasFatalError=!1,this.setPlaybackStartTime(),this.hasSegmentStarted||this.addSegment(),this.setLastSegmentStartPlayTime(),this.setLastSegmentPlaybackStartDate(),this.updateStallDuration(),this.updatePauseDuration(),this.setState({playbackState:y.Cy.PLAYING}),this.props.clearSeekTime&&this.props.clearSeekTime()})),b(this,"handleUserPause",(e=>{const{onControlsPause:t}=this.props;this.lastPauseTime=new Date,t&&t(e)})),b(this,"handleVideoPause",(()=>{this.state.playbackState!==y.Cy.STALLING&&this.state.playbackState!==y.Cy.SEEKING&&(this.updateWatchDurationForCurrentSegment(),this.lastPauseTime||this.updateStallDuration()),this.setState({playbackState:y.Cy.PAUSED})})),b(this,"handleSeeking",(()=>{this.playbackPerformance.numberOfSeeks+=1;const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1];t&&(t.lastStartPlayTime=null),this.state.playbackState!==y.Cy.ENDED&&this.setState({playbackState:y.Cy.SEEKING})})),b(this,"handleStalled",(()=>{null===this.lastStallTime&&this.state.playbackState!==y.Cy.ENDED&&(this.lastStallTime=new Date,this.playbackPerformance.numberOfStalls+=1,this.setState({playbackState:y.Cy.STALLING}))})),b(this,"handleTimeUpdate",(e=>{const{onTimeChange:t}=this.props;t&&t(e),this.state.playbackState===y.Cy.PLAYING&&(this.updateWatchDurationForCurrentSegment(),this.setLastSegmentStartPlayTime())})),b(this,"resetPlaybackMetrics",(()=>{this.hasSegmentStarted=!0,this.hasPlaybackStarted=!1,this.hasVideoSessionStarted=!1,this.hasVideoSessionEnded=!0,this.lastStallTime=null,this.lastPauseTime=null,this.videoSessionId="",this.videoVisibleTime=null,this.logSessionStartOnNextPlay=!1;const e={...this.playbackPerformance.segments[this.playbackPerformance.segments.length-1],lastStartPlayTime:null,playbackStartDate:null,watchedDurationMs:0};this.playbackPerformance.detailedErrors="",this.playbackPerformance.errorCode=0,this.playbackPerformance.errorName="",this.playbackPerformance.errorReason="",this.playbackPerformance.hasFatalError=!1,this.playbackPerformance.numberOfStalls=0,this.playbackPerformance.numberOfSeeks=0,this.playbackPerformance.playbackStartTimestamp=null,this.playbackPerformance.totalStallDurationMs=0,this.playbackPerformance.segments=[e]})),b(this,"setLastSegmentStartPlayTime",(()=>{const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1];t&&null===t.lastStartPlayTime&&(t.lastStartPlayTime=this.getCurrentVideoTime())})),b(this,"setLastSegmentPlaybackStartDate",(()=>{const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1];t&&null===t.playbackStartDate&&(t.playbackStartDate=Date.now())})),b(this,"setPlaybackStartTime",(()=>{this.hasPlaybackStarted||(this.playbackPerformance.playbackStartTimestamp=Date.now(),this.hasPlaybackStarted=!0)})),b(this,"setVideoPlayerRef",(e=>{const{setVideoRef:t}=this.props;if(e&&(t&&t(e),this.videoPlayerRef=e,this.videoPlayerRef.video)){const e=this.videoPlayerRef.video;e.addEventListener("loadedmetadata",this.handleLoadedMetadata),e.addEventListener("loadeddata",this.handleLoadedData),e.addEventListener("pause",this.handleVideoPause),e.readyState>=3&&(this.setState({canPlayVideo:!0}),this.playbackPerformance.canPlayTime=new Date)}})),b(this,"updateStallDuration",(()=>{if(null!==this.lastStallTime){const{lastStallTime:e}=this;this.playbackPerformance.totalStallDurationMs+=new Date-e,this.lastStallTime=null}})),b(this,"updatePauseDuration",(()=>{if(null!==this.lastPauseTime){const{lastPauseTime:e}=this;this.playbackPerformance.totalPauseDurationMs+=new Date-e,this.lastPauseTime=null}})),b(this,"updateWatchDurationForCurrentSegment",(()=>{const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1],a=t?t.lastStartPlayTime:null,i=this.getCurrentVideoTime();if(t&&null!==a&&"number"==typeof i&&"number"==typeof a){const e=i-a;e>0&&(t.watchedDurationMs+=e,t.lastStartPlayTime=null)}})),b(this,"logPlaybackPerformance",((e,t)=>{const{contextLogData:a={},userId:i,isAutoPlay:s,logContextEvent:o,preload:r}=this.props,{is_closeup_video:n=!1}=a,{canPlayTime:l,detailedErrors:c,errorCode:d,errorName:h,errorReason:u,hasFatalError:m,loadStartTime:b,totalPauseDurationMs:P,totalStallDurationMs:S,numberOfStalls:g,numberOfSeeks:v,playbackStartTimestamp:f,segments:k,srcString:T}=this.playbackPerformance,D=this.videoPlayerRef&&this.videoPlayerRef.video,C=e===y.DR,E=C&&!this.hasVideoSessionStarted,L=!C&&!this.hasVideoSessionEnded&&this.hasVideoSessionStarted;if(D&&(E||L)){var R;let E=-1;l&&b&&(E=l>b?l-b:0);let L=-1;l&&this.videoVisibleTime&&(L=l>this.videoVisibleTime?l-this.videoVisibleTime:0),C&&(this.videoSessionId=(0,y.Y7)(i),this.playerId=this.playerId||(0,y.EB)());const V=this.getVideoResourceTiming(),_={averageVideoKbps:-1,autoplaying:s,detailedErrors:c,downloadedKiloBytes:"number"==typeof(null==V?void 0:V.decodedBodySize)&&V.decodedBodySize/y.Fm||0,errorCode:d,errorName:h,errorReason:u,fatalError:m,isCellular:!1,nativeVideoDurationMs:D.duration*y.gJ||-1,numberOfStalls:g,numberOfSeeks:v,overallPausedDurationMs:P,overallBufferDurationMs:S,overallWatchedDurationMs:-1,rebufferRate:-1,playbackSessionId:this.videoSessionId,playbackStartTimestamp:f||-1,segments:[],sessionMark:e,screenPixelScale:null!==(R=window)&&void 0!==R&&R.devicePixelRatio?window.devicePixelRatio:-1,startupPlayerWidth:D.clientWidth,startupPlayerHeight:D.clientHeight,startupTimeMs:E,startupLatencyMs:L,startupVariantKbps:-1,startupVariantWatchedDurationMs:-1,startupVariantWidth:D.videoWidth,startupVariantHeight:D.videoHeight,videoUrl:T,wasVideoPreloaded:"auto"===r};if(!C){this.updateWatchDurationForCurrentSegment(),this.updateStallDuration();const e=k.reduce(((e,t)=>e+(t.watchedDurationMs||0)),0);_.overallWatchedDurationMs=e,_.startupVariantWatchedDurationMs=e,_.segments=this.playbackPerformance.segments,0===e?(_.errorName="invalid_watch_duration",_.rebufferRate=-1):_.rebufferRate=S/e}(0,p.ZP)(_,!1,n,{playbackState:this.state.playbackState,...t});const{view:w,viewParameter:M,component:A,element:x,objectId:I,...O}=a;o({event_type:3606,event_data:{videoPerformanceData:_},view_type:w,view_parameter:M,component:A,element:x,object_id_str:I,aux_data:{...O,is_closeup_video:n,playback_session_id:this.videoSessionId}}),C?(this.hasVideoSessionStarted=!0,this.hasVideoSessionEnded=!1):this.resetPlaybackMetrics(),(0,p.tE)(C?"sessionStart":"sessionEnd",!1,n,{playbackState:this.state.playbackState,...t})}}))}componentWillUnmount(){const{loop:e}=this.props;this.updatePauseDuration(),this.logPlaybackPerformance(y.$f,{initiator:"unmount",loop:e})}render(){const{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:o,accessibilityProgressBarLabel:r,accessibilityUnmuteLabel:n,aspectRatio:l,captions:c,controls:d,loop:h,loopOverride:u,objectFit:p,onDurationChange:y,onFullscreenChange:b,onLoadedChange:S,onControlsPlay:g,onPlayheadDown:v,onPlayheadUp:f,onSeek:k,onVolumeChange:T,playbackRate:D,playing:C,playsInline:E,poster:L,preload:R,src:V,volume:_}=this.props,{canPlayVideo:w,videoStartTime:M}=this.state;return(0,m.jsx)(s.nk,{autoplay:w&&C,accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:o,accessibilityProgressBarLabel:r,accessibilityUnmuteLabel:n,aspectRatio:l,captions:c,controls:d,loop:void 0===u?h:u,objectFit:p,onDurationChange:y,onEnded:this.handleEnded,onError:this.handleError,onFullscreenChange:b,onLoadedChange:S,onLoadStart:this.handleLoadStart,onControlsPause:this.handleUserPause,onControlsPlay:g,onPlaying:this.handlePlaying,onPlayheadDown:v,onPlayheadUp:f,onReady:this.handleCanPlayVideo,onSeek:k,onSeeking:this.handleSeeking,onStalled:this.handleStalled,onTimeChange:this.handleTimeUpdate,onVolumeChange:T,onWaiting:this.handleStalled,playbackRate:D,onPlay:()=>{},onPlayError:()=>{},playing:w&&C,playsInline:E,poster:L,preload:R,ref:this.setVideoPlayerRef,src:P(V,this.props.quicExpGroup),startTime:M||void 0,volume:_})}}const g=(0,i.memo)((function(e){const{logContextEvent:t}=(0,d.v)(),{country:a,isAuthenticated:i,isBot:s,isSocialBot:o,unauthId:l,userAgent:y}=(0,r.B)(),{browserName:b,browserVersion:P,isMobile:g}=y,{contextLogData:v={}}=e,{is_closeup_video:f=!1,view:k,viewParameter:T}=v,{appUI:{appInFocus:D}}=(0,c.I)(),{checkExperiment:C}=(0,h.F)(),{clearSeekTime:E}=(0,n.RC)();let L=null;i&&(L=C("web_video_quic").group.length?C("web_video_quic").group:null);const R=(0,u.Z)(),V={browserName:b,browserVersion:P,country:a,isAuthenticated:i,isBot:s,is_closeup_video:f,isMobile:g,isSocialBot:o,view:k,viewParameter:T};return(0,p.r$)(V),(0,m.jsx)(S,{...e,userId:R.id||l,appInFocus:D,quicExpGroup:L,logContextEvent:t,clearSeekTime:E})}));function v(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const f=e=>{if(Array.isArray(e)){const t=e.find((e=>"video/m3u8"===e.type));return t?t.src:void 0}return RegExp("m3u8$").test(e)?e:void 0};class k extends i.PureComponent{constructor(e){super(e),v(this,"componentDidUpdate",(e=>{var t;e.videoStartTime&&this.props.videoStartTime&&e.videoStartTime<this.props.videoStartTime&&null!==(t=this.videoPlayerRef)&&void 0!==t&&t.video&&(this.videoPlayerRef.video.currentTime=this.props.videoStartTime)})),v(this,"setVideoPlayerRef",(e=>{e&&(this.videoPlayerRef=e)})),v(this,"handleOnEnded",(({event:e})=>{const{loop:t,onLoop:a,onEnded:i}=this.props;i&&(i({event:e}),this.videoPlayerRef&&this.videoPlayerRef.video&&t&&(this.videoPlayerRef.video.play(),a&&a()))}));const t=f(e.src);this.state={useHlsVideo:!e.preferMp4&&!(0,o.G6)(e.requestContext.userAgent.browserName)&&!!t}}render(){const{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:o,accessibilityUnmuteLabel:r,aspectRatio:n,appInFocus:c,backgroundColor:d,captions:h,clearSeekTime:u,contextLogData:p,controls:y,hlsConfig:b,isAutoPlay:P,loop:S,objectFit:v,onDurationChange:k,onEnded:T,onFullscreenChange:D,onLoadedChange:C,onControlsPause:E,onControlsPlay:L,onPlayheadDown:R,onPlayheadUp:V,onReady:_,onSeek:w,onTimeChange:M,onVolumeChange:A,playbackRate:x,playing:I,playsInline:O,poster:F,preferMp4:N,preload:U,seekTime:B,src:W,videoStartTime:G,visible:j,volume:z}=this.props,{useHlsVideo:H}=this.state,K=f(W),$={...b,startPosition:G||-1},q=!T&&S;return H&&K?(0,m.jsx)(l.Z,{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:o,accessibilityUnmuteLabel:r,aspectRatio:n,appInFocus:c,backgroundColor:d,captions:h,clearSeekTime:u,contextLogData:p,controls:y,hlsConfig:$,isAutoPlay:P,loop:S,loopOverride:q,onDurationChange:k,onEnded:this.handleOnEnded,onFullscreenChange:D,onLoadedChange:C,onControlsPause:E,onControlsPlay:L,onPlayheadDown:R,onPlayheadUp:V,onReady:_,onSeek:w,onTimeChange:M,onVolumeChange:A,playbackRate:x,onPlay:()=>{},onPlayError:()=>{},playing:I,playsInline:O,poster:F,preload:U,seekTime:B,setVideoRef:this.setVideoPlayerRef,src:K,visible:j,volume:z}):(0,m.jsx)(g,{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:o,accessibilityUnmuteLabel:r,aspectRatio:n,captions:h,clearSeekTime:u,contextLogData:p,controls:y,isAutoPlay:P,loop:S,loopOverride:q,objectFit:v,onDurationChange:k,onEnded:this.handleOnEnded,onFullscreenChange:D,onLoadedChange:C,onControlsPause:E,onControlsPlay:L,onPlayheadDown:R,onPlayheadUp:V,onReady:_,onSeek:w,onTimeChange:M,onVolumeChange:A,playbackRate:x,onPlay:()=>{},onPlayError:()=>{},playing:I,playsInline:O,poster:F,preload:U,seekTime:B,setVideoRef:this.setVideoPlayerRef,src:N?W:K||W,videoStartTime:G,visible:j,volume:z})}}function T(e){const{appUI:{appInFocus:t}}=(0,c.I)(),{seekTime:a}=(0,n.Hx)(),{clearSeekTime:i}=(0,n.RC)(),s=(0,r.B)();return(0,m.jsx)(k,{...e,appInFocus:t,requestContext:s,clearSeekTime:i,seekTime:a})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/58103-262cb3af78e488ab.mjs.map